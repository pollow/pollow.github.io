<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>pollow's blog - Java</title>
        <link rel="stylesheet" href="http://pollow.github.io/theme/css/main.css" />
        <link href="http://pollow.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="pollow's blog Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="http://github.com/pollow/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://pollow.github.io/">pollow's blog </a></h1>
                <nav><ul>
                    <li><a href="/tags">Tags</a></li>
                    <li><a href="/archives">Archives</a></li>
                    <li><a href="http://pollow.github.io/pages/bookshelf.html">Bookshelf</a></li>
                    <li><a href="http://pollow.github.io/category/android.html">Android</a></li>
                    <li><a href="http://pollow.github.io/category/diary.html">Diary</a></li>
                    <li class="active"><a href="http://pollow.github.io/category/java.html">Java</a></li>
                    <li><a href="http://pollow.github.io/category/vcs.html">VCS</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://pollow.github.io/hibernate-ru-men-bi-ji.html">Hibernate 入门笔记</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-02-05T00:00:00+08:00">
                Published: 五 05 二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://pollow.github.io/author/xing-chang.html">XING Chang</a>
        </address>
<p>In <a href="http://pollow.github.io/category/java.html">Java</a>.</p>

</footer><!-- /.post-info --><p>Java 项目库看多了，尤其是Apache的，换上了严重的文档阅读恐惧症，严重倾向于阅读经过加工后的中文教材，然后去看reference。Getting Start真没什么好东西。</p>
<h2>基础</h2>
<p>Hibernate 是一个 ORM 框架，全称 Object-Relative Database-Mapping，显而易见，是一个在Java对象和关系型数据库之间建立连接的<strong>中间件</strong>。</p>
<p>Hibernate在2005年被JBoss收购，JBoss之后被Red Hat收购，所以现在算起来HIbernate是Red Hat旗下的开源库了。</p>
<p>早起Hibernate使用XML配置POJO（我现在的工程中使用的方法），现在的Hibernate支持JPA（Java Persistence API），也可以使用注解的方法配置（今天在浏览 Spring 框架的时候，看到也有一个 Spring Data，之后也可稍作研究）。</p>
<h2>使用笔记</h2>
<p>创建一个类，推荐为POJO，使用<code>@Entity</code>注解，使之为一个实体类，既与数据库有映射关系。实体类还需要在类声明处用<code>@Table</code>注解表明，属性处用<code>@id</code>定义主键，<code>@Column</code>定义列；还有其他的一些外键和类型注解。</p>
<p>Hibernate 通常还需要一个工具类，官方提供了HibernateUtil，用于方便创建Session，Transaction等。<code>SessionFactory</code>是一个线程安全的 Session 工厂类；得到Session后，每次执行请求，都需要打开Session，打开Transaction，执行请求，关闭Transaction，关闭Session。这种重复工作显然不合理。</p>
<p>在Web中使用 Hibernate，配置文件要设置<code>current_session_context_class</code>为thread (for tomcat,不知为何)。</p>
<p>推荐为 Hibernate 设置乐观锁，在POJO中增加一列</p>
<div class="highlight"><pre><span class="nd">@Version</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">version</span><span class="o">;</span>
</pre></div>


<p>问题是，会在数据库表中增加一列Version么？难道数据库的全部配置都要交给Hibernate，由Hibernate自动创建数据库么？一般来说，不都是DBA完成数据库的创建、调优，然后中间层只是方便CURD么？那么Hibernate如何利用View呢？</p>
<h2>外联关系</h2>
<p>Hibernate会自动处理复杂的外链关系，在声明POJO的时候需要配合注解使用。在配置文件中可以设置，取数据时是否连带外键一同获取，并且设置深度。cascade属性可以配置是否保存对象的同时保存外键。</p>
<p>查询外键的时候有延时加载和即时加载两种模式，推荐使用延迟加载（默认选项），获取更好的性能，但是也要考虑可能的异常（数据库连接断掉）。</p>
<h2>HQL</h2>
<p>HQL相对于SQL，只是针对面向对象的设计做了小修改。需要有如下注意点：</p>
<ol>
<li>在设计类名、包名时，大小写敏感</li>
<li>可以使用<code>select class</code>的方法获取对象，这种情况下也可以省略select语句。</li>
<li>如果查询的不是整个对象，而是一些字段，可以选择返回<code>Object[]</code>, <code>List</code>, <code>Map</code>，语法细节查询文档。</li>
<li>where字句允许通过.(dot)进行简单的外键访问，允许对集合类型调用size函数。</li>
<li>推荐使用名称占位符<code>:name</code>写入数据，调用<code>setParamter</code>系列函数传入数据（不知道是否会转义）。</li>
<li>分页可以调用Query对象的<code>setFirstResult</code>和<code>setMaxResults</code>函数。</li>
<li>也支持各种join查询。</li>
<li>用<code>SQLQuery</code>可以使用SQL进行查询，通过设置<code>addEntity</code>可以配置返回实体。</li>
<li>常用的简单查询可以使用<code>@NamedQuery</code>配置。  </li>
</ol>
<h2>Spring DAO模块</h2>
<p>如上所述，进行查询的时候通常需要一系列打开，关闭的琐碎操作，DAO层封装了这些操作。</p>
<h2>Spring Service模块</h2>
<h2>jOOQ</h2>
<h2>torpedoquery</h2>
<h2>Questions</h2>
<p><code>@GeneratedValue</code>是否会和数据库默认的auto increment 冲突？</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://pollow.github.io/zml-reading-note.html" rel="bookmark"
                           title="Permalink to ZML Reading Note">ZML Reading Note</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-02-03T00:00:00+08:00">
                Published: 三 03 二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://pollow.github.io/author/xing-chang.html">XING Chang</a>
        </address>
<p>In <a href="http://pollow.github.io/category/java.html">Java</a>.</p>

</footer><!-- /.post-info -->                
                <a class="readmore" href="http://pollow.github.io/zml-reading-note.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://pollow.github.io/java-web-de-ce-shi.html" rel="bookmark"
                           title="Permalink to Java Web 的测试">Java Web 的测试</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-01-23T00:00:00+08:00">
                Published: 六 23 一月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://pollow.github.io/author/xing-chang.html">XING Chang</a>
        </address>
<p>In <a href="http://pollow.github.io/category/java.html">Java</a>.</p>
<p>tags: <a href="http://pollow.github.io/tag/java.html">Java</a> <a href="http://pollow.github.io/tag/junit.html">JUnit</a> </p>
</footer><!-- /.post-info -->                <p>前几天研究了 Java Web 中如何利用 log4j 记录 log，方便追踪少见的错误和异常，更加优雅的拜托 stdout 来 debug。这几天主要要钻研一下如何在一个 Java Web 的大型系统中优雅的做测试，包括单元测试和集成测试。</p>
<p>由于工程庞大，错综复杂，而且目前一直处于在线调试的状态，缺少各种基础设施，所以加入测试难度颇高，今天简单的搜索了一下，检索到了一些关键技术和工具，暂作记录，空下来后慢慢研究。</p>
<ol>
<li>JUnit 4 -- StrutsSpringJUnit4TestCase</li>
<li><a href="http://watij.com/">Watji</a></li>
<li>h2 in-memory database</li>
<li>Mock Class</li>
</ol>
<p>感觉想要成功的为整套系统加入测试，对于很多 Java 的概念和框架还需要深入学习，目前看来，遇到 IoR 和 Bean 相关的概念时还是有些不明所以。</p>
<p>想要进行单元测试，有几个问题需要解决</p>
<ol>
<li>如何模拟 Request 请求 ...</li></ol>
                <a class="readmore" href="http://pollow.github.io/java-web-de-ce-shi.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://pollow.github.io/log4j-xue-xi-yu-pei-zhi.html" rel="bookmark"
                           title="Permalink to Log4j 学习与配置">Log4j 学习与配置</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-01-22T00:00:00+08:00">
                Published: 五 22 一月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://pollow.github.io/author/xing-chang.html">XING Chang</a>
        </address>
<p>In <a href="http://pollow.github.io/category/java.html">Java</a>.</p>
<p>tags: <a href="http://pollow.github.io/tag/java.html">Java</a> <a href="http://pollow.github.io/tag/log4j.html">log4j</a> </p>
</footer><!-- /.post-info -->                <p>开始的时候就被这个项目居然使用 System.out.println 调试大法震惊了一下，由于我也懒得在架构上动手脚，所以也就随大流将就一下。但是最近遇到几个问题，一是我写的一个方法逻辑太过复杂，有太多的数据库操作（其实应该避免，但是因为API不够丰富，逻辑又十分复杂暂时只能如此了）；二是有一些客户报告了一下我在本地无法复现，有很偶然才会发生的 bug，不得已，我决定使用一下 Logger，在相关的函数中记录一下关键值。</p>
<h2>基础使用</h2>
<p>记录需要使用 Logger, Logger 应该是单例模型，在应用初始化的时候创建并且保留以后一直使用；不过 LogManager 会处理这些事情，只要提供合适的 Logger 名称，它会在内部管理所有的 Logger。Logger的名字推荐和使用的类名一致，这也是<code>LogManager.getLogger()</code>的默认行为。</p>
<p>常用的又 INFO, DEBUG, WARN, ERROR 四个等级，对应四个函数；可以使用 printf 函数默认调用 String ...</p>
                <a class="readmore" href="http://pollow.github.io/log4j-xue-xi-yu-pei-zhi.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="#">You can modify those links in your config file</a></li>
                            <li><a href=""></a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://pollow.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.facebook.com/pollow.xc">Facebook</a></li>
                            <li><a href="http://github.com/ametaireau">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>